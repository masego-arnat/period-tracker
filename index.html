<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Period Tracker</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 12px;
        }
        .btn-primary {
            background: linear-gradient(45deg, #ff6b9d, #c44569);
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(45deg, #e55a8a, #b03e5f);
        }
        .google-btn {
            background: #4285f4;
            color: white;
        }
        .google-btn:hover {
            background: #357abd;
            color: white;
        }
    </style>
</head>
<body>
    <div class="hero-section">
        <div class="container">
            <h1>üå∏ Period Tracker</h1>
            <p class="lead">Track your menstrual cycle with ease and privacy</p>
        </div>
    </div>

    <div class="container mt-5">
        <!-- Authentication Section -->
        <div class="row justify-content-center mb-5">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">Authentication</h5>
                        <button id="googleSignIn" class="btn google-btn btn-lg w-100 mb-3">
                            üì± Sign in with Google
                        </button>
                        <button id="signOut" class="btn btn-outline-danger d-none">
                            üö™ Sign Out
                        </button>
                        <div id="userInfo" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Period Logging Form -->
        <div class="row justify-content-center mb-5">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">üìÖ Log Your Period</h5>
                        <form id="periodForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="startDate" class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="startDate" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="endDate" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="endDate">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="symptoms" class="form-label">Symptoms (Optional)</label>
                                <textarea class="form-control" id="symptoms" rows="3" placeholder="Cramps, headache, mood changes, etc."></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">üìù Log Period</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cycle History -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">üìä Cycle History</h5>
                        <ul id="cycleHistory" class="list-group list-group-flush">
                            <li class="list-group-item text-muted">Sign in to view your cycle history</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD2lun6Fle6g_No3vd50Ser6lp4l7yxxXw",
            authDomain: "movieapp-d4e7b.firebaseapp.com",
            databaseURL: "https://movieapp-d4e7b-default-rtdb.firebaseio.com",
            projectId: "movieapp-d4e7b",
            storageBucket: "movieapp-d4e7b.appspot.com",
            messagingSenderId: "456049902625",
            appId: "1:456049902625:web:7f7cfe094ac660d5230f60",
            measurementId: "G-BKTH5DMHGB"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentUser = null;

        // Google Sign-In
        document.getElementById('googleSignIn').addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            provider.addScope('email');
            provider.addScope('profile');
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    currentUser = result.user;
                    console.log('User signed in:', currentUser);
                    showNotification(`Welcome, ${currentUser.displayName}!`, 'success');
                    updateUI();
                })
                .catch((error) => {
                    console.error("Error signing in:", error);
                    showNotification("Failed to sign in. Please try again.", 'error');
                });
        });

        // Sign-Out
        document.getElementById('signOut').addEventListener('click', () => {
            auth.signOut()
                .then(() => {
                    currentUser = null;
                    console.log('User signed out');
                    showNotification('Successfully signed out', 'success');
                    updateUI();
                })
                .catch((error) => {
                    console.error("Error signing out:", error);
                    showNotification("Error signing out", 'error');
                });
        });

        // Track Auth State Changes
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            updateUI();
        });

        // Update UI Based on Auth State
        function updateUI() {
            const googleSignInBtn = document.getElementById('googleSignIn');
            const signOutBtn = document.getElementById('signOut');
            const userInfo = document.getElementById('userInfo');

            if (currentUser) {
                googleSignInBtn.classList.add('d-none');
                signOutBtn.classList.remove('d-none');
                userInfo.innerHTML = `
                    <div class="text-success">
                        <small>Signed in as: ${currentUser.displayName}</small>
                    </div>
                `;
                loadCycleHistory();
            } else {
                googleSignInBtn.classList.remove('d-none');
                signOutBtn.classList.add('d-none');
                userInfo.innerHTML = '';
                document.getElementById('cycleHistory').innerHTML = 
                    '<li class="list-group-item text-muted">Sign in to view your cycle history</li>';
            }
        }

        // Log Period Data
        document.getElementById('periodForm').addEventListener('submit', (e) => {
            e.preventDefault();
            if (!currentUser) {
                showNotification("Please sign in first.", 'error');
                return;
            }

            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const symptoms = document.getElementById('symptoms').value;

            if (!startDate) {
                showNotification("Please enter a start date.", 'error');
                return;
            }

            db.collection("periods").add({
                userId: currentUser.uid,
                startDate: startDate,
                endDate: endDate || null,
                symptoms: symptoms || '',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                showNotification("Period logged successfully!", 'success');
                document.getElementById('periodForm').reset();
                loadCycleHistory();
            }).catch((error) => {
                console.error("Error logging period:", error);
                showNotification("Error logging period. Please try again.", 'error');
            });
        });

        // Load Cycle History
        function loadCycleHistory() {
            if (!currentUser) return;

            const cycleHistory = document.getElementById('cycleHistory');
            cycleHistory.innerHTML = '<li class="list-group-item">Loading...</li>';

            db.collection("periods")
                .where("userId", "==", currentUser.uid)
                .orderBy("timestamp", "desc")
                .get()
                .then((querySnapshot) => {
                    cycleHistory.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        cycleHistory.innerHTML = '<li class="list-group-item text-muted">No periods logged yet</li>';
                        return;
                    }

                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        const li = document.createElement('li');
                        li.className = 'list-group-item';
                        
                        const endDateText = data.endDate ? ` to ${data.endDate}` : ' (ongoing)';
                        const symptomsText = data.symptoms ? `: ${data.symptoms}` : '';
                        
                        li.innerHTML = `
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <strong>${data.startDate}${endDateText}</strong>
                                    <br>
                                    <small class="text-muted">${symptomsText || 'No symptoms logged'}</small>
                                </div>
                                <button class="btn btn-sm btn-outline-danger" onclick="deletePeriod('${doc.id}')">
                                    üóëÔ∏è
                                </button>
                            </div>
                        `;
                        cycleHistory.appendChild(li);
                    });
                })
                .catch((error) => {
                    console.error("Error loading history:", error);
                    cycleHistory.innerHTML = '<li class="list-group-item text-danger">Error loading history</li>';
                });
        }

        // Delete Period Entry
        function deletePeriod(docId) {
            if (confirm('Are you sure you want to delete this period entry?')) {
                db.collection("periods").doc(docId).delete()
                    .then(() => {
                        showNotification("Period entry deleted", 'success');
                        loadCycleHistory();
                    })
                    .catch((error) => {
                        console.error("Error deleting period:", error);
                        showNotification("Error deleting entry", 'error');
                    });
            }
        }

        // Show Notification
        function showNotification(message, type) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);

            // Auto remove after 3 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }

        // Set today's date as default for start date
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>